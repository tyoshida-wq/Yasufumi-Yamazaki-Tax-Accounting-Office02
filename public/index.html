<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>山崎奏史税理士事務所 議事録生成アプリ</title>
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32.png">
    <link rel="icon" type="image/png" sizes="192x192" href="/favicon-192.png">
    <link rel="icon" type="image/png" sizes="512x512" href="/favicon-512.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="manifest" href="/manifest.json">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="/static/style.css" />
    <style>
      /* カスタムスタイル */
      .record-button {
        width: 200px;
        height: 200px;
        border-radius: 50%;
        background: linear-gradient(135deg, #4F7FFF 0%, #3B5FDB 100%);
        display: flex;
        align-items: center;
        justify-content: center;
        flex-direction: column;
        color: white;
        font-size: 18px;
        font-weight: 600;
        box-shadow: 0 10px 30px rgba(79, 127, 255, 0.3);
        transition: all 0.3s ease;
        cursor: pointer;
        border: none;
      }
      
      .record-button:hover {
        transform: scale(1.05);
        box-shadow: 0 15px 40px rgba(79, 127, 255, 0.4);
      }
      
      .record-button:active {
        transform: scale(0.95);
      }
      
      .record-button.recording {
        background: linear-gradient(135deg, #EF4444 0%, #DC2626 100%);
        animation: pulse 1.5s infinite;
      }
      
      @keyframes pulse {
        0%, 100% {
          box-shadow: 0 10px 30px rgba(239, 68, 68, 0.3);
        }
        50% {
          box-shadow: 0 15px 50px rgba(239, 68, 68, 0.5);
        }
      }
      
      .bottom-nav {
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        background: white;
        border-top: 1px solid #E2E8F0;
        display: flex;
        justify-content: space-around;
        padding: 12px 0;
        z-index: 1000;
      }
      
      .nav-item {
        display: flex;
        flex-direction: column;
        align-items: center;
        color: #94A3B8;
        font-size: 12px;
        text-decoration: none;
        position: relative;
      }
      
      .nav-item.active {
        color: #4F7FFF;
      }
      
      .nav-badge {
        position: absolute;
        top: -8px;
        right: -8px;
        background: #EF4444;
        color: white;
        border-radius: 12px;
        padding: 2px 6px;
        font-size: 10px;
        font-weight: 600;
        min-width: 20px;
        text-align: center;
      }
      
      .page {
        display: none;
        padding-bottom: 80px;
      }
      
      .page.active {
        display: block;
      }
      
      .meeting-card {
        background: white;
        border-radius: 12px;
        padding: 16px;
        margin-bottom: 12px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
      }
      
      .status-badge {
        display: inline-block;
        padding: 4px 12px;
        border-radius: 12px;
        font-size: 12px;
        font-weight: 600;
      }
      
      .status-badge.completed {
        background: #D1FAE5;
        color: #059669;
      }
      
      .status-badge.error {
        background: #FEE2E2;
        color: #DC2626;
      }
      
      .status-badge.processing {
        background: #DBEAFE;
        color: #2563EB;
      }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  </head>
  <body class="min-h-screen bg-gray-50">
    <!-- ホーム画面 -->
    <div id="page-home" class="page active">
      <header class="bg-white border-b border-gray-200 px-6 py-4">
        <p class="text-sm text-gray-600">山崎奏史税理士事務所</p>
        <h1 class="text-xl font-bold text-gray-900">議事録生成アプリ</h1>
      </header>
      
      <main class="px-6 py-8">
        <div class="text-center mb-8">
          <p class="text-gray-600 mb-2">ボタンを押すと音声認識が始まります</p>
        </div>
        
        <!-- 録音前の確認モーダル（初回のみ） -->
        <div id="recording-confirm-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
          <div class="bg-white rounded-lg shadow-xl max-w-md w-full mx-4 p-6">
            <div class="flex items-center mb-4">
              <div class="flex-shrink-0 w-12 h-12 rounded-full bg-yellow-100 flex items-center justify-center">
                <svg class="w-6 h-6 text-yellow-600" fill="currentColor" viewBox="0 0 24 24">
                  <path d="M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z"/>
                </svg>
              </div>
              <h3 class="ml-3 text-lg font-semibold text-gray-900">録音開始前の確認</h3>
            </div>
            <div class="mb-4 text-sm text-gray-700 space-y-3">
              <p class="font-semibold text-gray-900">録音中は以下の点にご注意ください：</p>
              <ul class="space-y-2">
                <li class="flex items-start">
                  <span class="mr-2">📡</span>
                  <span><strong>インターネット接続を維持</strong>してください（Wi-Fi/モバイル通信を切断しないでください）</span>
                </li>
                <li class="flex items-start">
                  <span class="mr-2">💻</span>
                  <span><strong>このタブを開いたまま</strong>にしてください（閉じると録音が停止します）</span>
                </li>
                <li class="flex items-start">
                  <span class="mr-2">📱</span>
                  <span><strong>電話の着信に注意</strong>してください（着信で録音が中断される可能性があります）</span>
                </li>
                <li class="flex items-start">
                  <span class="mr-2">🔋</span>
                  <span><strong>バッテリー残量を確認</strong>してください（長時間録音時は充電を推奨）</span>
                </li>
                <li class="flex items-start">
                  <span class="mr-2">🔇</span>
                  <span><strong>マイクを塞がない</strong>でください</span>
                </li>
              </ul>
            </div>
            <div class="mb-4">
              <label class="flex items-center text-sm text-gray-600 cursor-pointer">
                <input type="checkbox" id="recording-confirm-checkbox" class="mr-2">
                <span>次回から表示しない</span>
              </label>
            </div>
            <div class="flex space-x-3">
              <button id="recording-confirm-cancel" class="flex-1 px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 font-medium">
                キャンセル
              </button>
              <button id="recording-confirm-start" class="flex-1 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium">
                理解しました
              </button>
            </div>
          </div>
        </div>

        <!-- 録音中の注意バナー（常時表示） -->
        <div id="recording-warning-banner" class="hidden mb-6 bg-yellow-50 border-l-4 border-yellow-400 p-4 rounded-lg shadow-sm">
          <div class="flex items-start">
            <div class="flex-shrink-0">
              <svg class="w-5 h-5 text-yellow-600" fill="currentColor" viewBox="0 0 24 24">
                <path d="M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z"/>
              </svg>
            </div>
            <div class="ml-3 flex-1">
              <p class="text-sm font-semibold text-yellow-800 mb-1">⚠️ 録音中の注意事項</p>
              <p class="text-xs text-yellow-700">
                📡 ネット接続維持　💻 タブを閉じない　📱 電話に注意　🔋 バッテリー確認
              </p>
            </div>
          </div>
        </div>

        <!-- 録音ボタン -->
        <div class="flex justify-center mb-8">
          <button id="record-start" class="record-button">
            <svg class="w-16 h-16 mb-2" fill="currentColor" viewBox="0 0 24 24">
              <path d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3z"/>
              <path d="M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z"/>
            </svg>
            <span id="record-text">録音開始</span>
          </button>
        </div>
        
        <!-- 録音停止ボタン（非表示） -->
        <div class="flex justify-center mb-8 hidden" id="record-stop-container">
          <button id="record-stop" class="record-button bg-red-500 hover:bg-red-600">
            <svg class="w-16 h-16 mb-2" fill="currentColor" viewBox="0 0 24 24">
              <rect x="6" y="6" width="12" height="12" rx="2"/>
            </svg>
            <span>録音停止</span>
          </button>
        </div>
        
        <!-- 録音タイマー -->
        <div id="record-timer-container" class="text-center mb-8 hidden">
          <div class="text-4xl font-bold text-gray-900" id="record-timer">00:00:00</div>
          <div class="text-sm text-gray-500 mt-2" id="record-status">録音中...</div>
        </div>
        
        <!-- 音声ファイルをアップロード -->
        <button id="upload-button" class="w-full bg-green-500 hover:bg-green-600 text-white font-semibold py-4 px-6 rounded-lg shadow-lg flex items-center justify-center mb-4">
          <svg class="w-6 h-6 mr-2" fill="currentColor" viewBox="0 0 24 24">
            <path d="M9 16h6v-6h4l-7-7-7 7h4zm-4 2h14v2H5z"/>
          </svg>
          音声ファイルをアップロード
        </button>
        <input type="file" id="file-input" accept="audio/*" class="hidden" />
        
        <!-- ファイル選択後の情報表示 -->
        <div id="file-info-panel" class="hidden mb-4 p-4 bg-blue-50 border border-blue-200 rounded-lg">
          <h3 class="text-sm font-semibold text-blue-900 mb-2">選択されたファイル</h3>
          <pre id="file-summary" class="text-xs text-blue-800 whitespace-pre-wrap"></pre>
          <div id="audio-player-container" class="hidden mt-3">
            <audio id="audio-player" controls class="w-full"></audio>
            <button id="clear-audio" class="mt-2 text-sm text-red-600 hover:text-red-800">選択をクリア</button>
          </div>
          <button id="start-processing" disabled class="mt-3 w-full bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 text-white font-semibold py-2 px-4 rounded">
            処理を開始
          </button>
        </div>
        
        <!-- 処理進捗表示 -->
        <div id="progress-panel" class="hidden mb-4 p-4 bg-gray-50 border border-gray-200 rounded-lg">
          <h3 class="text-sm font-semibold text-gray-900 mb-2">処理進捗</h3>
          <div id="progress-summary" class="text-xs text-gray-700 mb-2"></div>
          <div class="w-full bg-gray-200 rounded-full h-2.5 mb-2">
            <div id="progress-bar" class="bg-blue-600 h-2.5 rounded-full" style="width: 0%"></div>
          </div>
          <div id="chunk-info" class="text-xs text-gray-600"></div>
        </div>
        
        <!-- ログ表示 -->
        <div id="logs-panel" class="hidden mb-4 p-4 bg-white border border-gray-200 rounded-lg">
          <h3 class="text-sm font-semibold text-gray-900 mb-2">処理ログ</h3>
          <div id="status-log" class="text-xs text-gray-700 max-h-32 overflow-y-auto mb-2 p-2 bg-gray-50 rounded font-mono"></div>
          <details class="text-xs">
            <summary class="cursor-pointer text-blue-600 hover:text-blue-800 mb-1">詳細ログを表示</summary>
            <div id="response-log" class="text-gray-700 max-h-32 overflow-y-auto mb-2 p-2 bg-gray-50 rounded font-mono"></div>
            <div id="server-log" class="text-gray-700 max-h-32 overflow-y-auto p-2 bg-gray-50 rounded font-mono"></div>
          </details>
        </div>
        
        <!-- 結果表示 -->
        <div id="results-panel" class="hidden mb-4">
          <!-- 文字起こし結果 -->
          <div class="mb-4 p-4 bg-white border border-gray-200 rounded-lg">
            <div class="flex justify-between items-center mb-2">
              <h3 class="text-sm font-semibold text-gray-900">文字起こし結果</h3>
              <div class="space-x-2">
                <button id="copy-transcript" class="text-xs text-blue-600 hover:text-blue-800">コピー</button>
                <button id="download-transcript" class="text-xs text-blue-600 hover:text-blue-800">ダウンロード</button>
              </div>
            </div>
            <pre id="transcript-output" class="text-xs text-gray-700 max-h-64 overflow-y-auto p-2 bg-gray-50 rounded whitespace-pre-wrap"></pre>
          </div>
          
          <!-- 議事録生成 -->
          <div class="mb-4 p-4 bg-white border border-gray-200 rounded-lg">
            <button id="generate-minutes" class="w-full bg-purple-600 hover:bg-purple-700 text-white font-semibold py-2 px-4 rounded mb-3">
              議事録を生成
            </button>
            <div id="minutes-section" class="hidden">
              <div class="flex justify-between items-center mb-2">
                <h3 class="text-sm font-semibold text-gray-900">議事録</h3>
                <div class="space-x-2">
                  <button id="copy-minutes" class="text-xs text-blue-600 hover:text-blue-800">コピー</button>
                  <button id="download-minutes" class="text-xs text-blue-600 hover:text-blue-800">ダウンロード</button>
                </div>
              </div>
              <pre id="minutes-output" class="text-xs text-gray-700 max-h-64 overflow-y-auto p-2 bg-gray-50 rounded whitespace-pre-wrap"></pre>
            </div>
          </div>
          
          <!-- リカバリボタン -->
          <div class="flex space-x-2">
            <button id="trigger-reprocess" class="hidden flex-1 bg-yellow-600 hover:bg-yellow-700 text-white text-xs font-semibold py-2 px-3 rounded">
              未処理チャンクを再処理
            </button>
            <button id="retry-merge" class="hidden flex-1 bg-orange-600 hover:bg-orange-700 text-white text-xs font-semibold py-2 px-3 rounded">
              結合を再試行
            </button>
          </div>
        </div>
        
        <!-- 過去の議事録を確認 -->
        <button id="history-button" class="w-full bg-white hover:bg-gray-50 text-gray-700 font-semibold py-4 px-6 rounded-lg shadow border border-gray-200 flex items-center justify-center">
          <svg class="w-6 h-6 mr-2" fill="currentColor" viewBox="0 0 24 24">
            <path d="M13 3c-4.97 0-9 4.03-9 9H1l3.89 3.89.07.14L9 12H6c0-3.87 3.13-7 7-7s7 3.13 7 7-3.13 7-7 7c-1.93 0-3.68-.79-4.94-2.06l-1.42 1.42C8.27 19.99 10.51 21 13 21c4.97 0 9-4.03 9-9s-4.03-9-9-9zm-1 5v5l4.28 2.54.72-1.21-3.5-2.08V8H12z"/>
          </svg>
          過去の議事録を確認
        </button>
        
        <!-- Voice Recognition System -->
        <div class="flex justify-center mt-8">
          <div class="text-center">
            <svg class="w-16 h-16 mx-auto text-blue-500" fill="currentColor" viewBox="0 0 24 24">
              <rect x="4" y="2" width="4" height="20" rx="2"/>
              <rect x="10" y="6" width="4" height="12" rx="2"/>
              <rect x="16" y="2" width="4" height="20" rx="2"/>
            </svg>
            <p class="text-xs text-gray-500 mt-2">VOICE RECOGNITION SYSTEM</p>
          </div>
        </div>
      </main>
    </div>
    
    <!-- 履歴画面 -->
    <div id="page-history" class="page">
      <header class="bg-white border-b border-gray-200 px-6 py-4 flex items-center justify-between">
        <h1 class="text-xl font-bold text-gray-900">過去の議事録</h1>
        <button id="refresh-history" class="text-blue-500">
          <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24">
            <path d="M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"/>
          </svg>
        </button>
      </header>
      
      <main class="px-6 py-4">
        <!-- 検索バー -->
        <div class="mb-4">
          <div class="flex gap-2">
            <input 
              type="text" 
              id="search-input" 
              placeholder="会議を検索（タイトル）"
              class="flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
            />
            <button id="search-button" class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-2 rounded-lg">
              検索
            </button>
          </div>
        </div>
        
        <!-- 会議リスト -->
        <div id="meeting-list" class="space-y-3">
          <div class="text-center text-gray-500 py-8">履歴を読み込んでいます...</div>
        </div>
      </main>
    </div>
    
    <!-- 管理画面 -->
    <div id="page-admin" class="page">
      <header class="bg-white border-b border-gray-200 px-6 py-4 flex items-center justify-between">
        <div class="flex items-center gap-2">
          <svg class="w-6 h-6 text-blue-500" fill="currentColor" viewBox="0 0 24 24">
            <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/>
          </svg>
          <h1 class="text-xl font-bold text-gray-900">アプリ使用統計</h1>
        </div>
        <button id="refresh-stats" class="text-blue-500 hover:text-blue-700">
          <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24">
            <path d="M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"/>
          </svg>
        </button>
      </header>
      
      <main class="px-6 py-4">
        <!-- 基本統計サマリー -->
        <div class="grid grid-cols-4 gap-4 mb-6">
          <div class="bg-white rounded-lg p-6 text-center shadow">
            <div class="text-3xl font-bold text-blue-600" id="stat-total-tasks">-</div>
            <div class="text-sm text-gray-600 mt-1">総タスク数</div>
            <div class="text-xs text-gray-400 mt-1">累積</div>
          </div>
          <div class="bg-white rounded-lg p-6 text-center shadow">
            <div class="text-3xl font-bold text-green-600" id="stat-total-hours">-</div>
            <div class="text-sm text-gray-600 mt-1">総音声長</div>
            <div class="text-xs text-gray-400 mt-1">時間</div>
          </div>
          <div class="bg-white rounded-lg p-6 text-center shadow">
            <div class="text-3xl font-bold text-purple-600" id="stat-total-chunks">-</div>
            <div class="text-sm text-gray-600 mt-1">総チャンク数</div>
            <div class="text-xs text-gray-400 mt-1">処理済み</div>
          </div>
          <div class="bg-white rounded-lg p-6 text-center shadow">
            <div class="text-3xl font-bold text-indigo-600" id="stat-total-minutes">-</div>
            <div class="text-sm text-gray-600 mt-1">総議事録数</div>
            <div class="text-xs text-gray-400 mt-1">生成済み</div>
          </div>
        </div>
        
        <!-- API使用状況 -->
        <div class="bg-white rounded-lg p-6 shadow mb-6">
          <h3 class="text-lg font-semibold mb-4 flex items-center">
            <svg class="w-5 h-5 mr-2 text-blue-500" fill="currentColor" viewBox="0 0 24 24">
              <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/>
            </svg>
            API使用状況
          </h3>
          <div class="grid grid-cols-2 gap-4">
            <div>
              <div class="text-sm text-gray-600">Gemini API呼び出し</div>
              <div class="text-2xl font-bold" id="stat-api-calls">-</div>
              <div class="text-xs text-gray-500 mt-1">
                文字起こし: <span id="stat-transcription-calls">-</span> / 
                議事録: <span id="stat-minutes-calls">-</span>
              </div>
            </div>
            <div>
              <div class="text-sm text-gray-600">推定APIコスト</div>
              <div class="text-2xl font-bold text-red-600">$<span id="stat-estimated-cost">-</span></div>
              <div class="text-xs text-gray-500 mt-1">Gemini 2.5 Flash 推定</div>
            </div>
          </div>
        </div>
        
        <!-- 時系列グラフ -->
        <div class="bg-white rounded-lg p-6 shadow mb-6">
          <h3 class="text-lg font-semibold mb-4 flex items-center">
            <svg class="w-5 h-5 mr-2 text-green-500" fill="currentColor" viewBox="0 0 24 24">
              <path d="M3.5 18.49l6-6.01 4 4L22 6.92l-1.41-1.41-7.09 7.97-4-4L2 16.99z"/>
            </svg>
            使用トレンド（過去30日）
          </h3>
          <canvas id="usage-chart" width="400" height="150"></canvas>
        </div>
        
        <!-- 詳細統計 -->
        <div class="bg-white rounded-lg p-6 shadow">
          <h3 class="text-lg font-semibold mb-4 flex items-center">
            <svg class="w-5 h-5 mr-2 text-purple-500" fill="currentColor" viewBox="0 0 24 24">
              <path d="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z"/>
            </svg>
            詳細統計
          </h3>
          <table class="w-full text-sm">
            <tbody>
              <tr class="border-b">
                <td class="py-2 text-gray-600">平均音声長</td>
                <td class="text-right font-semibold" id="stat-avg-duration">-</td>
              </tr>
              <tr class="border-b">
                <td class="py-2 text-gray-600">平均チャンク数/タスク</td>
                <td class="text-right font-semibold" id="stat-avg-chunks">-</td>
              </tr>
              <tr class="border-b">
                <td class="py-2 text-gray-600">エラー率</td>
                <td class="text-right font-semibold" id="stat-error-rate">-</td>
              </tr>
              <tr class="border-b">
                <td class="py-2 text-gray-600">R2ストレージ使用量</td>
                <td class="text-right font-semibold" id="stat-r2-storage">-</td>
              </tr>
              <tr class="border-b">
                <td class="py-2 text-gray-600">総文字起こし文字数</td>
                <td class="text-right font-semibold" id="stat-total-chars">-</td>
              </tr>
              <tr>
                <td class="py-2 text-gray-600">過去30日のタスク数</td>
                <td class="text-right font-semibold" id="stat-last-30-days">-</td>
              </tr>
            </tbody>
          </table>
        </div>
        
        <!-- コスト計算の説明 -->
        <div class="mt-6 bg-blue-50 border-l-4 border-blue-400 p-4 rounded">
          <p class="text-sm text-blue-800">
            <strong>💡 コスト推定について</strong><br>
            Gemini 2.5 Flash の料金: 音声入力 $1.00/100万トークン、テキスト入力 $0.30/100万トークン、出力 $2.50/100万トークン<br>
            推定方法: 音声1分あたり約1000トークン（入力）+ 150トークン（出力）、議事録生成は1件あたり約2000トークン（入力）+ 1000トークン（出力）で計算。<br>
            <span class="text-xs">※あくまで推定値です。実際のコストはCloudflareダッシュボードでご確認ください。</span>
          </p>
        </div>
      </main>
    </div>
    
    <!-- 進捗管理画面 -->
    <div id="page-progress" class="page">
      <header class="bg-white border-b border-gray-200 px-6 py-4">
        <h1 class="text-xl font-bold text-gray-900">進捗管理</h1>
      </header>
      
      <main class="px-6 py-4">
        <!-- タスク情報 -->
        <div id="task-info" class="mb-4 p-4 bg-blue-50 border border-blue-200 rounded-lg hidden">
          <div class="grid grid-cols-2 gap-2 text-xs">
            <div>
              <span class="text-gray-600">タスクID:</span>
              <span class="font-mono text-gray-900" id="progress-task-id">-</span>
            </div>
            <div>
              <span class="text-gray-600">ファイル名:</span>
              <span class="text-gray-900" id="progress-filename">-</span>
            </div>
            <div>
              <span class="text-gray-600">分割サイズ:</span>
              <span class="text-gray-900" id="progress-chunk-size">-</span>
            </div>
            <div>
              <span class="text-gray-600">チャンク:</span>
              <span class="text-gray-900" id="progress-chunks">-</span>
            </div>
            <div>
              <span class="text-gray-600">重複:</span>
              <span class="text-gray-900" id="progress-overlap">-</span>
            </div>
            <div>
              <span class="text-gray-600">並列:</span>
              <span class="text-gray-900" id="progress-parallel">-</span>
            </div>
            <div class="col-span-2">
              <span class="text-gray-600">Geminiモデル:</span>
              <span class="text-gray-900" id="progress-model">-</span>
            </div>
          </div>
        </div>
        
        <!-- ステータス表示 -->
        <div id="progress-status" class="mb-4 p-4 bg-white border border-gray-200 rounded-lg hidden">
          <div class="flex items-center justify-between mb-2">
            <span class="text-sm font-semibold text-gray-900" id="progress-status-text">待機中</span>
            <span class="text-xs text-gray-600" id="progress-chunk-count">0/0 チャンク処理済み</span>
          </div>
          <div class="w-full bg-gray-200 rounded-full h-2">
            <div id="progress-status-bar" class="bg-blue-600 h-2 rounded-full transition-all" style="width: 0%"></div>
          </div>
        </div>
        
        <!-- ログパネル -->
        <div class="grid grid-cols-1 gap-4">
          <!-- ステータスログ -->
          <div class="bg-gray-900 rounded-lg p-4">
            <h3 class="text-white text-sm font-semibold mb-2">ステータス</h3>
            <div id="progress-status-log" class="text-green-400 text-xs font-mono max-h-64 overflow-y-auto whitespace-pre-wrap">
              ログを読み込んでいます...
            </div>
          </div>
          
          <!-- 最新レスポンス -->
          <div class="bg-gray-900 rounded-lg p-4">
            <h3 class="text-white text-sm font-semibold mb-2">最新レスポンス</h3>
            <div id="progress-response-log" class="text-blue-400 text-xs font-mono max-h-64 overflow-y-auto whitespace-pre-wrap">
              レスポンスを待機中...
            </div>
          </div>
          
          <!-- サーバーログ -->
          <div class="bg-gray-900 rounded-lg p-4">
            <h3 class="text-white text-sm font-semibold mb-2">サーバーログ</h3>
            <div id="progress-server-log" class="text-yellow-400 text-xs font-mono max-h-64 overflow-y-auto whitespace-pre-wrap">
              サーバーログを読み込んでいます...
            </div>
          </div>
        </div>
        
        <!-- アクションボタン -->
        <div class="mt-4 flex gap-2">
          <button id="progress-reprocess" class="hidden flex-1 bg-yellow-600 hover:bg-yellow-700 text-white text-sm font-semibold py-2 px-4 rounded">
            未処理チャンクを再処理
          </button>
          <button id="progress-retry-merge" class="hidden flex-1 bg-orange-600 hover:bg-orange-700 text-white text-sm font-semibold py-2 px-4 rounded">
            結合を再試行
          </button>
        </div>
      </main>
    </div>
    
    
    <!-- オーディオプレイヤーモーダル -->
    <div id="audio-player-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50" style="display: none;">
      <div class="bg-white rounded-2xl p-6 max-w-md w-full mx-4 shadow-2xl">
        <div class="flex items-center justify-between mb-4">
          <h3 class="text-lg font-bold text-gray-900">音声再生</h3>
          <button id="close-player" class="text-gray-400 hover:text-gray-600">
            <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24">
              <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
            </svg>
          </button>
        </div>
        
        <div class="mb-4">
          <p class="text-sm text-gray-600 mb-2" id="player-title">会議音声</p>
          <p class="text-xs text-gray-400" id="player-date"></p>
        </div>
        
        <audio id="modal-audio-player" controls class="w-full">
          <source id="modal-audio-source" src="" type="audio/webm">
          お使いのブラウザは音声再生に対応していません。
        </audio>
        
        <div class="mt-4 text-xs text-gray-500">
          <p>※ 音声ファイルの読み込みに時間がかかる場合があります</p>
        </div>
      </div>
    </div>
    
    <!-- 議事録詳細モーダル -->
    <div id="minutes-detail-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50" style="display: none;">
      <div class="bg-white rounded-2xl max-w-2xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-hidden flex flex-col">
        <!-- ヘッダー -->
        <div class="bg-gradient-to-r from-purple-600 to-blue-600 p-6 text-white">
          <div class="flex items-center justify-between mb-2">
            <h3 class="text-2xl font-bold" id="detail-title">会議 2026/2/2 9:35:35</h3>
            <button id="close-minutes-detail" class="text-white hover:text-gray-200">
              <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24">
                <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
              </svg>
            </button>
          </div>
          <div class="flex items-center gap-4 text-sm">
            <span class="flex items-center gap-1">
              <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
                <path d="M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm.5-13H11v6l5.25 3.15.75-1.23-4.5-2.67z"/>
              </svg>
              <span id="detail-date"></span>
            </span>
            <span class="flex items-center gap-1">
              <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
              </svg>
              <span id="detail-duration"></span>
            </span>
          </div>
        </div>
        
        <!-- ボディ（スクロール可能） -->
        <div class="flex-1 overflow-y-auto p-6">
          <!-- アクションボタン -->
          <div class="flex gap-2 mb-4">
            <button id="detail-play-audio" class="flex-1 bg-blue-500 hover:bg-blue-600 text-white text-sm font-semibold py-2 px-4 rounded flex items-center justify-center gap-2">
              <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
                <path d="M8 5v14l11-7z"/>
              </svg>
              再生
            </button>
            <button id="detail-reprocess" class="flex-1 bg-orange-500 hover:bg-orange-600 text-white text-sm font-semibold py-2 px-4 rounded flex items-center justify-center gap-2">
              <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
                <path d="M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"/>
              </svg>
              最初から再処理する
            </button>
          </div>
          
          <!-- 議事録セクション -->
          <div class="mb-6">
            <div class="flex items-center justify-between mb-3">
              <h4 class="text-lg font-bold text-gray-900 flex items-center gap-2">
                <svg class="w-5 h-5 text-purple-600" fill="currentColor" viewBox="0 0 24 24">
                  <path d="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z"/>
                </svg>
                議事録
              </h4>
              <button id="detail-download-minutes" class="text-blue-600 hover:text-blue-800 text-sm font-semibold flex items-center gap-1">
                <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
                  <path d="M19 12v7H5v-7H3v7c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2v-7h-2zm-6 .67l2.59-2.58L17 11.5l-5 5-5-5 1.41-1.41L11 12.67V3h2z"/>
                </svg>
                ダウンロード
              </button>
            </div>
            <div id="detail-minutes-content" class="prose prose-sm max-w-none bg-purple-50 p-4 rounded-lg">
              議事録を読み込んでいます...
            </div>
          </div>
          
          <!-- 文字起こし全文セクション（折りたたみ可能） -->
          <div class="mb-6">
            <details class="group">
              <summary class="cursor-pointer list-none">
                <div class="flex items-center justify-between mb-3">
                  <h4 class="text-lg font-bold text-gray-900 flex items-center gap-2">
                    <svg class="w-5 h-5 text-blue-600" fill="currentColor" viewBox="0 0 24 24">
                      <path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/>
                    </svg>
                    文字起こし全文
                    <svg class="w-4 h-4 text-gray-500 group-open:rotate-180 transition-transform" fill="currentColor" viewBox="0 0 24 24">
                      <path d="M7 10l5 5 5-5z"/>
                    </svg>
                  </h4>
                  <button id="detail-download-transcript" class="text-blue-600 hover:text-blue-800 text-sm font-semibold flex items-center gap-1">
                    <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
                      <path d="M19 12v7H5v-7H3v7c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2v-7h-2zm-6 .67l2.59-2.58L17 11.5l-5 5-5-5 1.41-1.41L11 12.67V3h2z"/>
                    </svg>
                    ダウンロード
                  </button>
                </div>
              </summary>
              <div id="detail-transcript-content" class="prose prose-sm max-w-none bg-blue-50 p-4 rounded-lg whitespace-pre-wrap max-h-96 overflow-y-auto">
                文字起こしを読み込んでいます...
              </div>
            </details>
          </div>
        </div>
      </div>
    </div>
    
    <!-- ボトムナビゲーション -->
    <nav class="bottom-nav">
      <a href="#home" class="nav-item active" id="nav-home" data-page="home">
        <svg class="w-6 h-6 mb-1" fill="currentColor" viewBox="0 0 24 24">
          <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/>
        </svg>
        <span>ホーム</span>
      </a>
      <a href="#history" class="nav-item" id="nav-history" data-page="history">
        <svg class="w-6 h-6 mb-1" fill="currentColor" viewBox="0 0 24 24">
          <path d="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z"/>
        </svg>
        <span>履歴</span>
      </a>
      <a href="#progress" class="nav-item" id="nav-progress" data-page="progress">
        <svg class="w-6 h-6 mb-1" fill="currentColor" viewBox="0 0 24 24">
          <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
        </svg>
        <span>進捗</span>
      </a>
      <a href="#admin" class="nav-item" id="nav-admin" data-page="admin">
        <svg class="w-6 h-6 mb-1" fill="currentColor" viewBox="0 0 24 24">
          <path d="M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4z"/>
        </svg>
        <span>管理</span>
        <span class="nav-badge" id="error-count">70</span>
      </a>
    </nav>
    
    <!-- 隠しエレメント（バックエンドとの連携用） -->
    <audio id="audio-player" class="hidden"></audio>
    <canvas id="waveform-canvas" class="hidden"></canvas>
    
    <script type="module" src="/static/app.js?v=20260204064000"></script>
  </body>
</html>
